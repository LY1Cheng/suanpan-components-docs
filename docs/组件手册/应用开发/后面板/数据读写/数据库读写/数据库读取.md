# 数据库读取使用文档
| 组件名称 | 数据库读取 |  |  |
| --- | --- | --- | --- |
| 工具集 | 数据库读写 |  |  |
| 组件作者 | 雪浪云-墨文 |  |  |
| 文档版本 | 1.0 |  |  |
| 功能 | 用于读取数据库数据 |  |  |
| 镜像名称 | database-source-components:3 |  |  |
| 开发语言 | Python |  |  |

## 组件原理
使用该组件实现数据库读取功能，支持MySQL、Postgresql、Hive、SqlServer、Oracle、MariaDB、influxDB共七中数据库。

## 输入桩
支持任意类型数据输入，该输入可以作为触发组件读取数据表信号，也可以作为SQL语句的字符串拼接输入。

### 输入端子1

组件支持数字、字符串、JSON三种输入类型，输入数据可以作为变量拼接在自定义SQL语句中。

- **端口名称：** in1
- **输入类型：** 支持数字、字符串、JSON、所有类型
- **功能描述：** 触发组件下发数据或者作为变量拼接SQL语句

## 输出桩

### 输出端子1

- **端口名称：** out1
- **输出类型：** 支持Csv文件，对象
- **功能描述：** 输出读取到的表到下一个组件

## 组件使用
### 数据库连接配置
- 当首次进去组件页面时，页面会自动弹出一个连接窗口，让用户进行连接设置
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%961.png)
-   添加数据库连接，点击左上角"数据库连接"按钮或连接右边的“+”，目前支持MySQL、Postgresql、Hive、SqlServer、Oracle、MariaDB、influxDB共7种数据库源，如下图所示：

![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%962.png)
#### MySQL数据库
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%963.png)
- 服务器：服务器ip或者hostname
- 端口：服务端口，默认为3306
- 数据库名称：需要连接的数据库名称
- 用户名
- 密码
#### MariaDB数据库
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%964.png)

配置与Mysql类似

#### Postgresql数据库
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%965.png)

配置与Mysql类似

#### Sql Server数据库
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%966.png)

配置与Mysql类似
#### Hive数据库
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%967.png)

- 身份验证：可选无身份验证、kerberos、用户名和密码三种不同的登录方式连接到Hive数据库。

#### Oracle数据库
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%968.png)

- 连接类型：选择不同的连接类型连接到Oracle数据库，可选Basic和TNS。

#### InfluxDB数据库
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%969.png)

配置与Mysql类似

### 数据库配置

- 左侧上方为数据库连接列表，用户可以点击切换已经创建的连接，右侧列名会相应变化

![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9610.png)

- 数据库连接可以进行删除、修改操作，如下图所示：

![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9611.png)

- 左侧中间为数据库名称列表，用户可以选择需要使用的数据库

![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9612.png)

- 左侧下方栏为该数据库中的表，可以选中相应的表名，获取表中的schema信息以及预览信息（包含前100条数据）

![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9613.png)

### 数据表选择

- 界面的左侧，展示了当前选中表的schema，即列的名称与类型
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9614.png)

- 默认所有字段都会被选中，传递到下一个节点中，但也可以勾选所需的列，仅将选中的列传递到下一个节点中
- 界面的右侧，展示了选中表的数据预览，显示选中表的前100条数据

### 数据库设置完成

- 点击“部署”后，配置完成，节点向下一个节点发送数据，“部署”按钮切换为“编辑”按钮
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9615.png)
- 当前状态代表配置已完成，节点开始向下一个节点发送数据
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9616.png)
- 当前状态代表配置未完成，节点取消向下一个节点发送数据

### 设置输出格式

右上角"设置输出格式"按钮，如下图所示，可以选择输出的格式：
- CSV：输出结构化数据文件（输出桩需要设置为CSV文件）
- JSON：形如[{"a": 1, "b": 2}, {"a": 3, "b": 4}]格式的JSON数据（输出桩需要设置为对象）
- Echarts组件可视化：形如[["a", "b"], [1, 2], [3, 4]]格式的JSON数据，主要是与算盘的前面板组件对接，进行数据可视化使用（输出桩需要设置为对象）

![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9617.png)

### 自定义SQL

- 选择与“字段选择”同级的“SQL查询”标签，进入自定义SQL页面
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9618.png)
- 输入自定义SQL后，运行按钮亮起，此时可以执行，点击运行执行自定义SQL语句，右侧显示SQL运行结果预览
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9619.png)
- 当把输入变量作为SQL语句中的一部分时，点击运行，会弹出“模拟输入桩数据”弹窗，默认值为组件输入桩输入的值，可以修改本次执行SQL语句时该变量的值，但是仅作测试。点击确认执行带输入变量的SQL语句
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9620.png)
- 当设置了自定义的SQL之后，向下一个节点发送的数据就变成了这个SQL执行的结果
### 增量读取设置
- 该功能默认关闭
- 当执行SQL查询之后，该功能才可以被开启
- 设置界面如下图所示：
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9621.png)
- 设置增量字段，仅支持int类型的字段，根据该字段进行数据增量读取，建议使用类似id的Int型自增字段
- 当前增量进度为之前读取到的数据该列的值，默认为0
- 下一阶段起始值 默认与 当前增量进度 相同，但支持用户手动调整从某个值开始继续读取数据。
- 点击右下“设置”按钮，完成增量读取设置
- 完成增量读取设置后，在“SQL查询”页面下，“增量读取列”和“增量读取行”作为两个新的变量能够拼接在自定义SQL语句中。通过SQL语句中的WHERE条件，可实现增量读取
![](./img/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%9622.png)