# 数据聚合（Aggregate）使用文档
| 组件名称 | 数据聚合（Aggregate） |  |  |
| --- | --- | --- | --- |
| 工具集 | 数据处理 |  |  |
| 组件作者 | 雪浪云-墨文 |  |  |
| 文档版本 | 1.0 |  |  |
| 功能 | 数据聚合组件，可以进行数据的聚合操作 |  |  |
| 镜像名称 | data-analysis-components:3 |  |  |
| 开发语言 | Python |  |  |

## 组件原理
使用该组件实现数据聚合操作

## 输入桩

### 输入端子1

- **端口名称：** in1
- **输出类型：** Csv文件
- **功能描述：** Csv文件输入

## 输出桩

### 输出端子1

- **端口名称：** out1
- **输出类型：** Csv文件
- **功能描述：** 将聚合好的Csv文件输出

## 参数配置

### 配置页面

1. 操作界面

大致分为四部分，如下图所示。1，2，3，4部分分别按顺序对应工具栏，字段列表，分组字段，聚合字段。
![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%881.png)

2. 输出设置

右上角"设置输出格式"按钮，如下图所示，可以选择输出的格式：
- CSV：输出结构化数据文件（输出桩需要设置为CSV文件）
- JSON：形如[{"a": 1, "b": 2}, {"a": 3, "b": 4}]格式的JSON数据（输出桩需要设置为对象）
- Echarts组件可视化：形如[["a", "b"], [1, 2], [3, 4]]格式的JSON数据，主要是与算盘的前面板组件对接，进行数据可视化使用（输出桩需要设置为对象）
- 字符串：输出选中字符串值

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%882.png)

3. 字段列表

包括【全部添加】按钮，【全部移除】按钮和字段列表（显示信息包括数据类型，字段类型，字段名称）
- 全部添加：将所有字段都添加至分组字段或聚合字段框
- 全部移除：分组字段与聚合字段框中所有字段删除
- 字段列表
    - 数据类型：数值、布尔值、日期、字符串
    - 字段类型：分组、聚合

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%883.png)

4. 分组字段

包括字段数据概览以及字段数据详情分别对应下图1，2部分。数据概览中显示数据的统计分布信息，数据详情中展示所有数据。

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%884.png)

4. 聚合字段

包括字段数据概览以及字段数据详情分别对应下图1，2部分。数据概览中显示数据的统计分布信息，数据详情中展示所有数据。

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%885.png)

点击聚合字段中卡片标题可弹出聚合函数选项，用户可自定切换聚合函数，并且支持用户自定义聚合函数

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%886.png)

5. 将字段加入分组字段/聚合字段框

- 将字段列表中的字段通过拖拽方式放入分组字段或聚合字段中，两个框中显示数据信息。聚合方式默认为"计数"；字段可以重复拖动到聚合栏中，进行多次的聚合，计算多种指标；当一个字段被拖动到聚合字段后，生成的结果字段名称会按照"[聚合方式]([原字段名])"的格式进行命名，例如，TAX字段进行计数聚合，则生成的列名为"count(TAX)"

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%887.png)

- 从字段列表中拖入分组字段，字段类型变为"分组"；拖入聚合字段，字段类型变为"聚合"

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%888.png)


- 从分组字段拖入聚合字段，或者在下拉框中选择聚合，字段类型自动变为"聚合"，
- 从聚合字段拖入分组字段，或者在下拉框中选择分组， 字段类型自动变为"分组"
- 在分组字段中的字段，不能再被拖入到聚合字段中；反之，在聚合字段中的字段，也不能再被拖入到分组字段中

- 在聚合字段中的卡片上点击聚合方式，在下拉框中选择一种聚合方式，各类型字段支持的聚合方式不同，如下表所示：

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%889.png)

- 字符串，日期以及布尔类型类型字段可选的聚合方式

| 聚合方式 | 简介 |
| --- | --- |
| 计数 | 返回组中的项目数。不对 Null 值计数。（sql模式支持） |
| 不同计数 | 返回组中不同项目的数量。不对 Null 值计数。（sql模式支持） |
| 最小值 | 返回表达式在所有记录中的最小值。（sql模式支持） |
| 最大值 | 返回表达式在所有记录中的最大值。（sql模式支持） |
| 累计最小值 | 返回从起始位置至当前位置所有数据中的最小值。（只能在没有分组字段的时候使用） |
| 累计最大值 | 返回从起始位置至当前位置所有数据中的最大值。（只能在没有分组字段的时候使用） |
| 自定义聚合函数 | 通过用户输入的python自定义聚合函数进行聚合 |

- 数值（整型、浮点型）的字段可选的聚合方式

| 聚合方式 | 简介 |
| --- | --- |
| 求和 | 返回表达式中所有值的总计，会忽略 Null 值。（sql模式支持） |
| 平均数 | 返回表达式中所有值的平均值，会忽略 Null 值。（sql模式支持） |
| 计数 | 返回组中的项目数。不对 Null 值计数。（sql模式支持） |
| 不同计数 | 返回组中不同项目的数量。不对 Null 值计数。（sql模式支持） |
| 最小值 | 返回表达式在所有记录中的最小值。（sql模式支持） |
| 最大值 | 返回表达式在所有记录中的最大值。（sql模式支持） |
| 标准差 | 基于群体样本返回给定表达式中所有值的统计标准差。 |
| 方差 | 基于群体样本返回给定表达式中所有值的统计方差。 |
| 累计最小值 | 返回从起始位置至当前位置所有数据中的最小值。（只能在没有分组字段的时候使用） |
| 累计最大值 | 返回从起始位置至当前位置所有数据中的最大值。（只能在没有分组字段的时候使用） |
| 累加和 | 返回从起始位置至当前位置所有数据的和。（只能在没有分组字段的时候使用） |
| 自定义聚合函数 | 通过用户输入的python自定义聚合函数进行聚合 |

- 自定义函数将作用于每一个分组，分别返回函数的返回值。自定义聚合函数示例如下所示，功能为返回每组数据中最大值最小值之差。

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%8810.png)

- 全部添加按钮:将字段列表中的所有字段，自动根据字段类型添加到分组字段和聚合字段中

- 全部移除按钮:将分组字段和聚合字段中的所有
数据移除，自动添加到字段列

- 修改字段名:仅聚合字段才可以进行修改，分组字段不支持修改列名。聚合完成后，聚合字段中的字段名称，可以进行修改，修改方式为双击字段名，进行修改。如下图所示：

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%8811.png)

- 修改的操作，会记录在左侧操作栏中，如下图所示

![](./img/%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%8812.png)